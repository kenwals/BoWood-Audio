<div class="container">
  <h2 class="bowood-title-text">Reviews</h2>
  <div class="row">
    <div class="col-cm-6">
      {% if user.is_authenticated %}
      <!-- Button trigger modal -->
      <button type="button" class="btn btn-outline-light btn-sm my-3" data-bs-toggle="modal"
        data-bs-target="#newReviewModal">
        Submit a new review
      </button>
      {% endif %}
    </div>
  </div>
  {% if reviews %}
  <div class="row">
    {% for review in reviews %}
    <div class="col-sm-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title bowood-title-text text-capitalize"> {{ review.review_title }}</h5>
          <p class="card-text"> {{ review.review_text }} </p>
          <p class="bowood-text-muted text-capitalize"><span>(<i class="far fa-star"></i> {{review.rating}} )</span>
            reviewer: {{ review.userid }}</p>
          {% if user.is_authenticated and user.get_username == review.userid.user.username %}
          <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal"
            data-bs-target="#editReviewModal">Edit</button>
          <a href="{% url 'delete_review' review.id %}" class="btn btn-outline-danger btn-sm">Delete</a>
          {% endif %}
        </div>
      </div>
      <!-- Edit Review Modal -->
      {% if user.is_authenticated and user.get_username == review.userid.user.username %}
      <div class="modal fade" id="editReviewModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="editReviewLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editReviewLabel">Edit Review</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{% url 'edit_review' review.id %}" method="post">
              {% csrf_token %}
              <div class="modal-body">
                {% for field in edit_review_form %}
                {{ field | as_crispy_field }}
                {% endfor %}
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>

  {% else %}
  <div class="col-sm-6">
    <p> No reviews yet! </p>
  </div>
  {% endif %}
  <!-- New Review Modal -->
  <div class="modal fade" id="newReviewModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="newReviewLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form action="{% url 'add_review' product.id %}" method="post">
          {% csrf_token %}
          <div class="modal-body">
            {% for field in review_form %}
            {{ field | as_crispy_field }}
            {% endfor %}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-outline-dark" type="submit">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>